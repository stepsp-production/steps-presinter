// يخدم hls.js من نطاقك مع مصادر احتياطية وكاش مناسب
export async function onRequest() {
  const cdns = [
    'https://cdn.jsdelivr.net/npm/hls.js@1.5.8/dist/hls.min.js',
    'https://unpkg.com/hls.js@1.5.8/dist/hls.min.js',
  ];

  for (const url of cdns) {
    try {
      const r = await fetch(url, { cf: { cacheEverything: true, cacheTtl: 86400 } });
      if (r.ok) {
        return new Response(r.body, {
          headers: {
            'Content-Type': 'application/javascript; charset=utf-8',
            'Cache-Control': 'public, max-age=86400, s-maxage=604800, immutable',
            'Access-Control-Allow-Origin': '*',
            'X-Source-URL': url,
          },
        });
      }
    } catch (_) {}
  }
  return new Response('CDN fetch failed (hls.min.js)', { status: 502 });
}
